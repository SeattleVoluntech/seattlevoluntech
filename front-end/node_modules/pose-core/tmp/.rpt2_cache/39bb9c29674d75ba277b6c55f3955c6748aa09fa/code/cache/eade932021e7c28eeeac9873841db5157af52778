{"code":"import { getPoseValues } from '../inc/selectors';\r\nimport { resolveProp } from './setter';\r\nexport var DEFAULT_INITIAL_POSE = 'init';\r\nvar isScale = function (key) { return key.includes('scale'); };\r\nvar defaultReadValueFromSource = function (key) { return (isScale(key) ? 1 : 0); };\r\nvar readValueFromPose = function (pose, key, props) {\r\n    var valueToResolve = pose.applyAtEnd && pose.applyAtEnd[key] !== undefined\r\n        ? pose.applyAtEnd[key]\r\n        : pose[key] !== undefined\r\n            ? pose[key]\r\n            : pose.applyAtStart && pose.applyAtStart[key] !== undefined\r\n                ? pose.applyAtStart[key]\r\n                : 0;\r\n    return resolveProp(valueToResolve, props);\r\n};\r\nvar getPosesToSearch = function (pose) {\r\n    var posesToSearch = Array.isArray(pose) ? pose : [pose];\r\n    posesToSearch.push(DEFAULT_INITIAL_POSE);\r\n    return posesToSearch;\r\n};\r\nvar getInitialValue = function (poses, key, initialPose, props, readValueFromSource, activePoses) {\r\n    if (readValueFromSource === void 0) { readValueFromSource = defaultReadValueFromSource; }\r\n    var posesToSearch = getPosesToSearch(initialPose);\r\n    var pose = posesToSearch.filter(Boolean).find(function (name) {\r\n        var thisPose = poses[name];\r\n        return (thisPose &&\r\n            (thisPose[key] !== undefined ||\r\n                (thisPose.applyAtStart && thisPose.applyAtStart[key] !== undefined) ||\r\n                (thisPose.applyAtEnd && thisPose.applyAtEnd[key] !== undefined)));\r\n    });\r\n    activePoses.set(key, [pose || DEFAULT_INITIAL_POSE]);\r\n    return pose\r\n        ? readValueFromPose(poses[pose], key, props)\r\n        : readValueFromSource(key, props);\r\n};\r\nvar createValues = function (values, _a) {\r\n    var userSetValues = _a.userSetValues, createValue = _a.createValue, convertValue = _a.convertValue, readValueFromSource = _a.readValueFromSource, initialPose = _a.initialPose, poses = _a.poses, activePoses = _a.activePoses, props = _a.props;\r\n    return function (key) {\r\n        if (values.has(key))\r\n            return;\r\n        var value;\r\n        if (userSetValues && userSetValues[key] !== undefined) {\r\n            value = convertValue(userSetValues[key], key, props);\r\n        }\r\n        else {\r\n            var initValue = getInitialValue(poses, key, initialPose, props, readValueFromSource, activePoses);\r\n            value = createValue(initValue, key, props);\r\n        }\r\n        values.set(key, value);\r\n    };\r\n};\r\nvar scrapeValuesFromPose = function (values, props) { return function (key) {\r\n    var pose = props.poses[key];\r\n    Object.keys(getPoseValues(pose)).forEach(createValues(values, props));\r\n}; };\r\nvar getAncestorValue = function (key, fromParent, ancestors) {\r\n    if (fromParent === true) {\r\n        return ancestors[0] && ancestors[0].values.get(key);\r\n    }\r\n    else {\r\n        var foundAncestor = ancestors.find(function (_a) {\r\n            var label = _a.label;\r\n            return label === fromParent;\r\n        });\r\n        return foundAncestor && foundAncestor.values.get(key);\r\n    }\r\n};\r\nvar bindPassiveValues = function (values, _a) {\r\n    var passive = _a.passive, ancestorValues = _a.ancestorValues, createValue = _a.createValue, readValue = _a.readValue, props = _a.props;\r\n    return function (key) {\r\n        var _a = passive[key], valueKey = _a[0], passiveProps = _a[1], fromParent = _a[2];\r\n        var valueToBind = fromParent && ancestorValues.length\r\n            ? getAncestorValue(valueKey, fromParent, ancestorValues)\r\n            : values.has(valueKey) ? values.get(valueKey) : false;\r\n        if (!valueToBind)\r\n            return;\r\n        var newValue = createValue(readValue(valueToBind), key, props, {\r\n            passiveParentKey: valueKey,\r\n            passiveParent: valueToBind,\r\n            passiveProps: passiveProps\r\n        });\r\n        values.set(key, newValue);\r\n    };\r\n};\r\nvar setNativeValues = function (_a) {\r\n    var setValueNative = _a.setValueNative, initialPose = _a.initialPose, props = _a.props, poses = _a.poses;\r\n    var valuesHaveSet = new Set();\r\n    var setValues = function (pose, propKey) {\r\n        if (pose[propKey]) {\r\n            for (var key in pose[propKey]) {\r\n                if (!valuesHaveSet.has(key)) {\r\n                    valuesHaveSet.add(key);\r\n                    setValueNative(key, resolveProp(pose[propKey][key], props), props);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    getPosesToSearch(initialPose).forEach(function (poseKey) {\r\n        var pose = poses[poseKey];\r\n        if (pose) {\r\n            setValues(pose, 'applyAtEnd');\r\n            setValues(pose, 'applyAtStart');\r\n        }\r\n    });\r\n};\r\nvar createValueMap = function (props) {\r\n    var poses = props.poses, passive = props.passive;\r\n    var values = new Map();\r\n    Object.keys(poses).forEach(scrapeValuesFromPose(values, props));\r\n    setNativeValues(props);\r\n    if (passive)\r\n        Object.keys(passive).forEach(bindPassiveValues(values, props));\r\n    return values;\r\n};\r\nexport default createValueMap;\r\n//# sourceMappingURL=values.js.map","map":"{\"version\":3,\"file\":\"values.js\",\"sourceRoot\":\"\",\"sources\":[\"../src/factories/values.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/mattperry/Sites/popmotion/packages/pose-core/factories/values.d.ts","text":"import { AncestorValueList, Props, PoseMap, PassiveValueMap, ReadValue, ReadValueFromSource, CreateValue, ConvertValue, ActivePoses, SetValueNative } from '../types';\r\ndeclare type ValueFactoryProps<V, A> = {\r\n    poses: PoseMap<A>;\r\n    passive?: PassiveValueMap;\r\n    ancestorValues: AncestorValueList<V>;\r\n    readValue: ReadValue<V>;\r\n    createValue: CreateValue<V>;\r\n    convertValue: ConvertValue<V>;\r\n    userSetValues: {\r\n        [key: string]: V;\r\n    };\r\n    initialPose?: string | string[];\r\n    readValueFromSource?: ReadValueFromSource;\r\n    setValueNative: SetValueNative;\r\n    activePoses: ActivePoses;\r\n    props: Props;\r\n};\r\nexport declare const DEFAULT_INITIAL_POSE = \"init\";\r\ndeclare const createValueMap: <V, A>(props: ValueFactoryProps<V, A>) => Map<string, V>;\r\nexport default createValueMap;\r\n"}}
